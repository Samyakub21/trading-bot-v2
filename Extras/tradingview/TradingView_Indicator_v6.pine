// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© YourTradingBot - INDICATOR VERSION (No Strategy)

//@version=6
indicator("Trading Bot Signals (Indicator)", overlay=true)

// ============================================================================
// INPUT PARAMETERS
// ============================================================================

// Signal Thresholds
rsiBullishThreshold = input.int(60, "RSI Bullish Threshold", minval=50, maxval=70, group="Signal Settings")
rsiBearishThreshold = input.int(40, "RSI Bearish Threshold", minval=30, maxval=50, group="Signal Settings")
adxThreshold = input.int(25, "ADX Threshold", minval=15, maxval=35, group="Signal Settings")
volumeMultiplier = input.float(1.2, "Volume Multiplier", minval=1.0, maxval=3.0, step=0.1, group="Signal Settings")

// Indicator Lengths
ema50Length = input.int(50, "EMA Length (60min)", minval=20, maxval=200, group="Indicator Settings")
ema200Length = input.int(200, "EMA 200 Length (15min)", minval=100, maxval=300, group="Indicator Settings")
rsiLength = input.int(14, "RSI Length", minval=5, maxval=30, group="Indicator Settings")
adxLength = input.int(14, "ADX Length", minval=5, maxval=30, group="Indicator Settings")

// Time Filter (NSE Only)
enableTimeFilter = input.bool(false, "Enable Time Filter (11:30-13:30)", group="Time Filter")
timezoneOffset = input.int(330, "Timezone Offset (minutes from UTC)", minval=-720, maxval=720, group="Time Filter")

// Stop Loss Settings
slBuffer = input.int(2, "SL Buffer Points", minval=1, maxval=10, group="Stop Loss")
showSLLevels = input.bool(true, "Show SL Levels", group="Stop Loss")

// Display Options
showSignals = input.bool(true, "Show Buy/Sell Signals", group="Display")
showEMA = input.bool(true, "Show EMA (Trend)", group="Display")
showVWAP = input.bool(true, "Show VWAP", group="Display")
showInfoPanel = input.bool(true, "Show Info Panel", group="Display")
showBackgroundColor = input.bool(false, "Show Background Colors", group="Display")

// ============================================================================
// TECHNICAL INDICATORS
// ============================================================================

// === 60-MINUTE TREND (EMA 50) ===
// Request 60min data for trend
ema50_value = request.security(syminfo.tickerid, "60", ta.ema(close, ema50Length), lookahead=barmerge.lookahead_off)

// === 15-MINUTE INDICATORS ===
// EMA 200 for trend alignment
ema200_value = ta.ema(close, ema200Length)

// ADX for trend strength (provide adx smoothing parameter)
[diPlus, diMinus, adx] = ta.dmi(adxLength, adxLength)

// === VWAP ===
vwap_value = ta.vwap(hlc3)

// === RSI ===
rsi = ta.rsi(close, rsiLength)

// === VOLUME ===
volAvg = ta.sma(volume, 20)

// === TIME FILTER ===
currentTime = minute(time) + (hour(time) * 60) + (timezoneOffset)
isNoTradeZone = enableTimeFilter and (currentTime >= 690 and currentTime <= 810) // 11:30-13:30 IST

// ============================================================================
// SIGNAL LOGIC
// ============================================================================

// Volume Confirmation
volumeConfirmed = volume >= (volAvg * volumeMultiplier)

// Trend Strength (ADX)
trendStrength = adx > adxThreshold

// Time Filter (only apply if enabled)
timeAllowed = not isNoTradeZone

// BULLISH SIGNAL (CALL)
// 1. Trend Confirmation (60min): Price > EMA50
// 2. Trend Alignment (15min): Price > EMA200
// 3. Trigger (15min): Price > VWAP
// 4. Momentum (15min): RSI > 60
// 5. Trend Strength (15min): ADX > 25
// 6. Volume Confirmation
// 7. Time Filter (if enabled)
bullishTrend = close > ema50_value
bullishAlignment = close > ema200_value
bullishTrigger = close > vwap_value
bullishMomentum = rsi > rsiBullishThreshold

bullishSignal = bullishTrend and bullishAlignment and bullishTrigger and bullishMomentum and trendStrength and volumeConfirmed and timeAllowed

// BEARISH SIGNAL (PUT)
// 1. Trend Confirmation (60min): Price < EMA50
// 2. Trend Alignment (15min): Price < EMA200
// 3. Trigger (15min): Price < VWAP
// 4. Momentum (15min): RSI < 40
// 5. Trend Strength (15min): ADX > 25
// 6. Volume Confirmation
// 7. Time Filter (if enabled)
bearishTrend = close < ema50_value
bearishAlignment = close < ema200_value
bearishTrigger = close < vwap_value
bearishMomentum = rsi < rsiBearishThreshold

bearishSignal = bearishTrend and bearishAlignment and bearishTrigger and bearishMomentum and trendStrength and volumeConfirmed and timeAllowed

// ============================================================================
// DYNAMIC STOP LOSS CALCULATION
// ============================================================================

// Calculate SL levels for current bar
calcSL_Long = ta.lowest(low[1], 2) - slBuffer
calcSL_Short = ta.highest(high[1], 2) + slBuffer

// Adjust if too close
sl_Long = (close - calcSL_Long) < 5 ? close - 10 : calcSL_Long
sl_Short = (calcSL_Short - close) < 5 ? close + 10 : calcSL_Short

// Store SL on signal
var float lastBullishSL = na
var float lastBearishSL = na

if bullishSignal
    lastBullishSL := sl_Long

if bearishSignal
    lastBearishSL := sl_Short

// ============================================================================
// VISUAL ELEMENTS
// ============================================================================

// Plot EMA (Trend Line)
plot(showEMA ? ema50_value : na, "EMA 50 (60min)", color=color.new(color.orange, 0), linewidth=2)
plot(showEMA ? ema200_value : na, "EMA 200 (15min)", color=color.new(color.purple, 0), linewidth=1, style=plot.style_stepline)

// Plot VWAP
plot(showVWAP ? vwap_value : na, "VWAP", color=color.new(color.blue, 20), linewidth=2, style=plot.style_line)

// Plot Buy/Sell Signals
plotshape(showSignals and bullishSignal, "BUY (CALL)", shape.labelup, location.belowbar, 
         color=color.new(color.green, 0), text="CALL", textcolor=color.white, size=size.normal)
         
plotshape(showSignals and bearishSignal, "SELL (PUT)", shape.labeldown, location.abovebar, 
         color=color.new(color.red, 0), text="PUT", textcolor=color.white, size=size.normal)

// Plot Stop Loss Levels
plot(showSLLevels and bullishSignal ? sl_Long : na, "Long SL", color=color.new(color.red, 0), 
     linewidth=2, style=plot.style_cross, offset=1)
     
plot(showSLLevels and bearishSignal ? sl_Short : na, "Short SL", color=color.new(color.red, 0), 
     linewidth=2, style=plot.style_cross, offset=1)

// Background Colors for Signal Zones
bgcolor(showBackgroundColor and bullishTrend and bullishAlignment and bullishTrigger and bullishMomentum and trendStrength ? color.new(color.green, 95) : na, title="Bullish Zone")
bgcolor(showBackgroundColor and bearishTrend and bearishAlignment and bearishTrigger and bearishMomentum and trendStrength ? color.new(color.red, 95) : na, title="Bearish Zone")

// ============================================================================
// INFORMATION PANEL
// ============================================================================

if showInfoPanel
    var table infoTable = table.new(position.top_right, 2, 9, 
                                     bgcolor=color.new(#000000, 85), 
                                     border_width=2, 
                                     border_color=color.new(#555555, 50))
    
    if barstate.islast
        // Header
        table.cell(infoTable, 0, 0, "Signal Dashboard", text_color=color.white, 
                  bgcolor=color.new(#1E88E5, 70), text_size=size.normal)
        table.cell(infoTable, 1, 0, "", bgcolor=color.new(#1E88E5, 70))
        
        // ADX Value
        adxColor = adx > adxThreshold ? color.new(color.lime, 0) : color.new(color.gray, 0)
        table.cell(infoTable, 0, 1, "ADX (" + str.tostring(adxLength) + ")", 
                  text_color=color.new(color.white, 0), text_size=size.small)
        table.cell(infoTable, 1, 1, str.tostring(adx, "#.#"), 
                  text_color=adxColor, text_size=size.normal)
        
        // RSI Value
        rsiColor = rsi > rsiBullishThreshold ? color.new(color.lime, 0) : 
                   rsi < rsiBearishThreshold ? color.new(color.red, 0) : color.new(color.gray, 0)
        table.cell(infoTable, 0, 2, "RSI (" + str.tostring(rsiLength) + ")", 
                  text_color=color.new(color.white, 0), text_size=size.small)
        table.cell(infoTable, 1, 2, str.tostring(rsi, "#.#"), 
                  text_color=rsiColor, text_size=size.normal)
        
        // Volume Ratio
        volRatio = volAvg > 0 ? volume / volAvg : 1.0
        volColor = volRatio >= volumeMultiplier ? color.new(color.lime, 0) : color.new(color.gray, 0)
        table.cell(infoTable, 0, 3, "Vol/Avg", 
                  text_color=color.new(color.white, 0), text_size=size.small)
        table.cell(infoTable, 1, 3, str.tostring(volRatio, "#.##") + "x", 
                  text_color=volColor, text_size=size.normal)
        
        // Trend (EMA 50)
        trendStatus = close > ema50_value ? "BULL â†‘" : close < ema50_value ? "BEAR â†“" : "NEUTRAL â†’"
        trendColor = close > ema50_value ? color.new(color.lime, 0) : 
                     close < ema50_value ? color.new(color.red, 0) : color.new(color.gray, 0)
        table.cell(infoTable, 0, 4, "Trend (60m)", 
                  text_color=color.new(color.white, 0), text_size=size.small)
        table.cell(infoTable, 1, 4, trendStatus, 
                  text_color=trendColor, text_size=size.normal)
        
        // EMA 200 Alignment
        ema200Status = close > ema200_value ? "ABOVE â†‘" : "BELOW â†“"
        ema200Color = close > ema200_value ? color.new(color.lime, 0) : color.new(color.red, 0)
        table.cell(infoTable, 0, 5, "EMA200 Align", 
                  text_color=color.new(color.white, 0), text_size=size.small)
        table.cell(infoTable, 1, 5, ema200Status, 
                  text_color=ema200Color, text_size=size.normal)
        
        // VWAP Position
        vwapStatus = close > vwap_value ? "ABOVE â†‘" : "BELOW â†“"
        vwapColor = close > vwap_value ? color.new(color.lime, 0) : color.new(color.red, 0)
        table.cell(infoTable, 0, 6, "VWAP", 
                  text_color=color.new(color.white, 0), text_size=size.small)
        table.cell(infoTable, 1, 6, vwapStatus, 
                  text_color=vwapColor, text_size=size.normal)
        
        // Market Zone
        zoneStatus = isNoTradeZone ? "NO-TRADE" : "ACTIVE"
        zoneColor = isNoTradeZone ? color.new(color.red, 0) : color.new(color.lime, 0)
        table.cell(infoTable, 0, 7, "Market Zone", 
                  text_color=color.new(color.white, 0), text_size=size.small)
        table.cell(infoTable, 1, 7, zoneStatus, 
                  text_color=zoneColor, text_size=size.normal)
        
        // Signal Status
        signalText = bullishSignal ? "ðŸš€ CALL" : bearishSignal ? "ðŸ”» PUT" : "â¸ NONE"
        signalColor = bullishSignal ? color.new(color.lime, 0) : 
                      bearishSignal ? color.new(color.red, 0) : color.new(color.gray, 0)
        table.cell(infoTable, 0, 8, "Signal", 
                  text_color=color.new(color.white, 0), text_size=size.small, 
                  bgcolor=signalColor)
        table.cell(infoTable, 1, 8, signalText, 
                  text_color=color.white, text_size=size.normal, 
                  bgcolor=signalColor)

// ============================================================================
// RSI PANEL (Bottom)
// ============================================================================

// Separate RSI indicator panel
hline(rsiBullishThreshold, "Bullish Threshold", color=color.new(color.green, 50), linestyle=hline.style_dotted)
hline(50, "Midline", color=color.new(color.gray, 70), linestyle=hline.style_dotted)
hline(rsiBearishThreshold, "Bearish Threshold", color=color.new(color.red, 50), linestyle=hline.style_dotted)

// ============================================================================
// ALERTS
// ============================================================================

alertcondition(bullishSignal, "Bullish CALL Signal", "ðŸš€ CALL Entry Signal!\nADX: {{adx}}\nRSI: {{rsi}}\nPrice: {{close}}")
alertcondition(bearishSignal, "Bearish PUT Signal", "ðŸ”» PUT Entry Signal!\nADX: {{adx}}\nRSI: {{rsi}}\nPrice: {{close}}")

// Combined alert for any signal
alertcondition(bullishSignal or bearishSignal, "Any Signal", 
              "âš¡ Trading Signal Generated!\nType: {{bullishSignal ? 'CALL' : 'PUT'}}\nADX: {{adx}}\nRSI: {{rsi}}\nPrice: {{close}}")

// ============================================================================
// NOTES & INSTRUCTIONS
// ============================================================================
// 
// HOW TO USE:
// ===========
// 1. Apply this indicator to your chart
// 2. Recommended timeframe: 15-minute or lower
// 3. Works on: Futures, Commodities (Crude Oil, Natural Gas, Gold, Silver), Indices (Nifty, BankNifty)
// 
// SIGNAL CONDITIONS:
// ==================
// 
// BULLISH (CALL) Signal:
// âœ“ Price > EMA50 (60min) - Trend confirmation
// âœ“ Price > EMA200 (15min) - Trend alignment
// âœ“ Price > VWAP - Above value area
// âœ“ RSI > 60 - Strong momentum
// âœ“ ADX > 25 - Trend strength confirmation
// âœ“ Volume > 1.2x Average - Volume confirmation
// âœ“ Time Filter (if enabled): Outside 11:30-13:30 IST
// 
// BEARISH (PUT) Signal:
// âœ“ Price < EMA50 (60min) - Trend confirmation
// âœ“ Price < EMA200 (15min) - Trend alignment
// âœ“ Price < VWAP - Below value area
// âœ“ RSI < 40 - Weak momentum
// âœ“ ADX > 25 - Trend strength confirmation
// âœ“ Volume > 1.2x Average - Volume confirmation
// âœ“ Time Filter (if enabled): Outside 11:30-13:30 IST
// 
// STOP LOSS:
// ==========
// - Calculated based on swing high/low of previous 2 bars
// - Buffer of 2 points added for safety
// - Minimum 5 points from entry to avoid too-tight stops
// 
// RISK MANAGEMENT:
// ================
// - Use with proper position sizing
// - Recommended: 2% risk per trade
// - Trail stops using step ladder:
//   * 1:2 RR â†’ Lock 1R profit
//   * 1:3 RR â†’ Lock 2R profit  
//   * 1:4 RR â†’ Lock 3R profit
//   * 1:5 RR â†’ Full exit (Jackpot)
// 
// ALERTS:
// =======
// 1. Click "Add Alert" button
// 2. Condition: Select "Bullish CALL Signal" or "Bearish PUT Signal"
// 3. Or use "Any Signal" to catch both
// 4. Set alert frequency to "Once Per Bar Close"
// 5. Connect to your trading app/bot via webhook
// 
// CUSTOMIZATION:
// ==============
// - Adjust RSI thresholds for different markets
// - Change volume multiplier based on instrument liquidity
// - Modify EMA length for different trend sensitivities
// - Toggle background colors for visual aid
// 
// BACKTESTING:
// ============
// - Use "TradingView_Strategy_v6.pine" for backtesting with strategy tester
// - This indicator version is for live signal monitoring only
// 
// ============================================================================
